---
title: 第一讲——数据库初始
id: 1
date: 2019-8-29 20:00:00
tags: mysql
comment: true
---

### 数据库的基础认识

数据库服务器：一台装了数据库管理软件的机器

数据库管理系统（DBMS）：就是一款软件

关系型数据库（RDBMS）：Mysql

库：文件夹

表：文件

记录：一条一条的信息

SQL语句：结构化查询语句

### 数据库的分类

**关系型**

解释：关系型数据库模型是把复杂的数据结构归结为简单的二元关系（即二维表格形式，不是excel，但是和excel的形式很像）

Mysql：

```
Mysql被广泛的应用在Internet上的大中小型网站中；其体积小、速度快、总体拥有成本低，开放源代码。
```

Oracle：

```
Oracle公司是目前全球最大的数据库软件公司，也是近年业务增长极为迅速的软件提供与服务商 。主要应用范围：传统大企业、大公司、政府、金融、证券等。
```

SQL Server：

```
Microsoft SQL Server是微软公司开发的大型关系数据库系统。SQL Server的功能比较全面，效率高，可以作为中型企业或单位的数据库平台。SQL Server可以与Winodws操作系统紧密集成，不论是应用程序开发速度还是系统事务处理运行速度，都得到较大的提升，对于在Windows平台上开发的各种企业级信息管理系统来说，不论是C/S（客户机/服务器）架构还是B/S（浏览器/服务器）架构。SQL Server都是一个很好的选择。SQL Server的缺点是只能在Windows系统下运行
```

Access

```
　Access是入门级小型桌面数据库，性能安全性都很一般，可供个人管理或小型企业使用；Access不是数据库语言，只是一个数据库程序。
```
<!----more---->
**非关系型**

解释：非关系型数据库也被成为NoSQL数据库，NoSQL的本意是“Not Olnly SQL”，指的是非关系型数据库，而不是“No SQL”的意思，因此，NoSQL的产生并不是要彻底地否定关系型数据库，而是作为传统关系型数据库的一个有效补充。NoSQL数据库在特定的场景下可以发挥出难以想象的高效率和高性能。 

非关系型数据库的类型

```
（1）键值（Key-Value）存储数据库
        
        键值数据库就类似传统语言中使用哈希表，可以通过key来添加、查询或删除数据，因为使用key主键访问，所以会获得很高的性能及扩展性 
        键值（Key-Value）数据库主要是使用一个哈希表，这个表中有一个特定的键和一个指针指向特定的数据。Key/value模型对于IT系统来说的优势在于简单、易部署、高并发 
        k1—>数据 
        k2—>数据 
        典型产品：Memcached、Redis、MemcacheDB、BerkeleyDB 

（2）列存储（Column-oriedted）数据库 ======>了解即可，一般公司用不到 
         这部分数据库通常用来分布式存储的海量数据，键仍然存在，但是他们的特点是指向了多个列。 
        典型产品：Cassandra,HBase 

（3）面向文档（Document-Oriented）数据库
        面向文档数据库会将以文档的形式存储。每个文档都是自包含的数据单元，是一系列数据项的集合。每个数据项都有一个名称与对应的值，值既可以是简单的数据类型，如字符串、数字和日期等；也可以是复杂的类型，如有序列表和关系对象。数据存储的最小单位是文档，同一个表中存储的文档属性可以是不同的，数据可以使用XML、JSON或者JSONB等多种形式存储 
        典型产品：MorgoDB、CouchDB 

（4）图形（Graph）数据库
```

 具体的数据库实例

memcached（key-value）

```
1、key-value行数据库 
2、纯内存数据库 
3、持久化memcachedb（sina）
```

Redis（key-value）

```
redis也是一个key-value型存储系统。但redis支持的存储value类型相对更多，包括string（字符串）、list（链表）、set（集合）和zset（有序集合）等。这些数据类型都支持push/pop、add/remove及取交集、并集和差集及更丰富的操作，而且这些操作都是原子性的。为了保证效率，redis的数据都是缓存在内存中。区别是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在基础上实现了master-slave（主从）同步。 

　　redis是一个高性能的key-value数据库。redis的出现、很大程度补偿了memcached这类key/value存储的不足，在部分场合可以对关系数据库起到很好的补充作用。它提供了Python、Ruby、Erlang、PHP客户端，使用方便。 
　　官方：http://www.redis.io/documentation 
　　redis特点： 
　　1）支持内存缓存，这个功能相当于memcached 
　　2）支持持久化存储，这个功能相当于memcachedb，ttserver 
　　3）数据库类型更丰富。比其他key-value库功能更强 
　　4）支持主从集群、分布式 
　　5）支持队列等特殊功能 
　　应用：缓存从存取memcached更改存取redis
```

MongoDB（Document-oriented）

```
　　MongoDB是一个介于关系型数据库和非关系型数据库之间的产品，是非关系型数据库当中功能最丰富，最像关系数据库的。他支持的数据库结构非常松散，类似json的bjson格式，因此可以存储比较复杂的数据类型。Mongodb最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。 

　　特点： 
　　　　高性能、易部署、易使用、存储数据非常方便 
　　主要功能特性： 

　　　　1.面向集合存储，易存储对象类型的数据 
　　　　2.“面向集合”（Collenction-Orented）意思是数据库被分组存储在数据集中，被称为一个集合（Collenction）每个 集合在数据库中都有一个唯一的标识名，并且可以包含无限数目的文档，集合的概念类似关系型数据库（RDBMS）里的表（table）不同的是它不需要定义任何模式（schema） 
　　　　3.模式自由 
　　　　　　模式自由（schema-free）意为着存储在mongodb数据库中的文件，我们不需要知道它的任何结构定义。 
　　　　4.支持动态查询 
　　　　5.支持完全索引，包含内部对象 
　　　　6.支持查询 
　　　　7.支持复制和故障恢复 
　　　　8.使用高效的二进制数据存储，包括大型对象 
　　　　9.自动处理碎片、以支持云计算层次的扩展性
```

### 数据库的基本操作

MySQL客户端连接服务端时的完整指令：

```
mysql -h IP -P PORT -u root -p password
```

启动服务器：

```
net start mysql
```

停止服务器：

```
net stop mysql
```

退出Mysql命令行：

```
quit、exit
```

修改密码：

```
mysqladmin -u root -p old_password paassword new_password
```

增加新用户：

```
grant select on 数据库.*to 用户名@登录主机 identifiedv by '密码'
```

查看字符集编码指令：

```
show variables like "%char%"；
```

忘记密怎么修改密码:

```
1，停掉MySQL服务端（net stop mysql）
2,切换到mysql安装目录下的bin目录下，然后手动指定启动程序来启动mysql（mysqld.exe --skip-grant-tables）
3,重新启动一个窗口，连接mysql
4，修改mysql库里面的user表里面的root用户记录的密码
update user set password = password("new_password") where user ='root'
5,关掉mysqld服务端(进程),在资源管理器中找到该服务，关掉
或者在命令行中使用命令tasklist|findstr mysqld 查看mysqld的进程号，然后taskkill /F /PID mysqld的进程号杀死该进程
6，正常启动服务端（net start mysql）
```

修改密码的三种方式

```
方法1： 用SET PASSWORD命令 
　　　　首先登录MySQL，使用mysql自带的那个客户端连接上mysql。 
　　　　格式：mysql> set password for 用户名@localhost = password('新密码'); 
　　　　例子：mysql> set password for root@localhost = password('123'); 
　　　　
方法2：用mysqladmin  （因为我们将bin已经添加到环境变量了，这个mysqladmin也在bin目录下，所以可以直接使用这个mysqladmin功能，使用它来修改密码）

　　　　关于mysqladmin的介绍：是一个执行管理操作的客户端程序。它可以用来检查服务器的配置和当前状态、创建和删除数据库、修改用户密码等等的功能，虽然mysqladmin的很多功能通过使用MySQL自带的mysql客户端可以搞定，但是有时候使用mysqladmin操作会比较简单。
　　　　格式：mysqladmin -u用户名 -p旧密码 password 新密码 
　　　　例子：mysqladmin -uroot -p123456 password 123 　
　　　　
方法3：用UPDATE直接编辑那个自动的mysql库中的user表 
　　　　首先登录MySQL，连接上mysql服务端。 
　　　　mysql> use mysql;   use mysql的意思是切换到mysql这个库，这个库是所有的用户表和权限相关的表都在这个库里面，我们进入到这个库才能修改这个库里面的表。
　　　　mysql> update user set password=password('123') where user='root' and host='localhost';   其中password=password('123') 前面的password是变量，后面的password是mysql提供的给密码加密用的，我们最好不要明文的存密码，对吧，其中user是一个表，存着所有的mysql用户的信息。

　　　　mysql> flush privileges;  刷新权限，让其生效，否则不生效，修改不成功。
```

data文件夹

```
这个是存放数据的文件夹，mysql中我们创建和保存的数据都存在这里
它的下面有一个mysql文件夹。这个mysql是整个服务的核心数据库，类似sql server的master表，主要负责储存数据库的用户、权限设置、关键字等mysql自己需要使用的控制和管理信息。
```



### 库表行的sql语句（增删改查）

**库**

查看数据库：

```
show databases;
```

创建数据库默认编码：

```
create database db_name;
```

创建数据库并指定编码：

```
create database db_name charset utf-8;
```

使用数据库：

```
use db_name;(切换到指定数据库,操作表必须先切到指定数据库)
```

修改数据库的字符集：

```
alter database db_name charset utf-8;
```

删除数据库：

```
drop database db_name;
```

**表**

操作表的第一步就是先切换到指定的数据库

```
use database;
```

查看当前在哪个数据库

```
select database();
```

创建表：

```
create table db_table(id int,name char(16));
```

查看当前数据库下所有的表：

```
show tables;
```

查看表单的创建信息：

```
show create table 表名;
```

查看一张表的基本数据：

```
desc db_table;
```

修改字段的数据类型：

```
alter table  db_table modify 字段名  新数据类型；
```

既修改表的字段名和数据类型：

```
alter table db_table change 旧字段名   新字段名 新数据类型；
```

删除表：

```
drop table db_table;
```

**记录**

新增一条记录：

```
方式一：insert into stu values((1,'pl'),(2,'penglin'));
推荐使用第二种方式
方式二：insert into stu(id,name) values (1,'pl');
```

查看记录:

```
select * from db_tabl;
```

条件查询：

```
select * from db_table where id =1;
```

修改记录：

```
update db_table  set  字段 =新数据  where id = 3;
```

删除记录：

```
delect from db_table where name = "pl";
```

清空表

```
自增ID的话，新增的数据会接着删除的数据的id
delete from db_table;
数据量大的时候，这条命令更加快，如果设置了自增，那么它新增的数据从1开始
truncate table db_table;
auto_increment:表示自增
primary key:表示约束
```

### 补充

**存储引擎**

​		首先确定一点，存储引擎的概念是MySQL里面才有的，不是所有的关系型数据库都有存储引擎这个概念。

```
	对于用户和应用程序来说同样一张表的数据，无论用什么引擎来存储，用户能够看到的数据是一样的。不同储引擎存取，引擎功能，占用空间大小，读取性能等可能有区别。说白了，存储引擎就是在如何存储数据、提取数据、更新数据等技术方法的实现上，底层的实现方式不同，那么就会呈现出不同存储引擎有着一些自己独有的特点和功能，对应着不同的存取机制。
	因为在关系数据库中数据的存储是以表的形式存储的，所以存储引擎也可以称为表类型(即：对表的存储、操作等的实现方法不同)，表是什么，表本质上就是磁盘上的文件。
	MySQL最常用的存储引擎为：MyISAM和InnoDB。
```

**引擎的分类**

查看MySQL的所有引擎：show engines;

查看当亲正在使用的引擎：show variables like "storage_engine%"

**InnoDB引擎**

```mysql
#InnoDB引擎特点
        介绍：InnoDB引擎是MySQL数据库的另一个重要的存储引擎，正称为目前MySQL AB所发行新版的标准，被包含在所有二进制安装包里。和其他的存储引擎相比，InnoDB引擎的优点是支持兼容ACID的事务(类似于PostGreSQL)，以及参数完整性(即对外键的支持)。Oracle公司与2005年10月收购了Innobase。Innobase采用双认证授权。它使用GNU发行，也允许其他想将InnoDB结合到商业软件的团体获得授权。

InnoDB引擎特点：
        1.支持事务：支持4个事务隔离界别，支持多版本读。
        2.行级锁定(更新时一般是锁定当前行)：通过索引实现，全表扫描仍然会是表锁，注意间隙锁的影响。
        3.读写阻塞与事务隔离级别相关(有多个级别，这就不介绍啦~)。
        4.具体非常高效的缓存特性：能缓存索引，也能缓存数据。
        5.整个表和主键与Cluster方式存储，组成一颗平衡树。(了解)
        6.所有SecondaryIndex都会保存主键信息。(了解)
        7.支持分区，表空间，类似oracle数据库。
        8.支持外键约束，不支持全文索引(5.5之前)，以后的都支持了。
        9.和MyISAM引擎比较，InnoDB对硬件资源要求还是比较高的。
        
        小结：三个重要功能：Supports transactions，row-level locking，and foreign keys

#InnoDB引擎调优精要
        1.主键尽可能小，避免给Secondery index带来过大的空间负担。
        2.避免全表扫描，因为会使用表锁。
        3.尽可能缓存所有的索引和数据，提高响应速度，较少磁盘IO消耗。
        4.在大批量小插入的时候，尽量自己控制事务而不要使用autocommit自动提交，有开关可以控制提交方式。
        5合理设置innodb_flush_log_at_trx_commit参数值，不要过度追求安全性。
        如果innodb_flush_log_at_trx_commit的值为0，log buffer每秒就会被刷写日志文件到磁盘，提交事务的时候不做任何操作。
        6.避免主键更新，因为这会带来大量的数据移动。
        
        可以看一看InnoDB的重要参数学习一下。
```

![](http://9017499461.linshutu.top/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%95%E6%93%8E.png)

**什么是事务**

```
事务介绍：
        简单地说，事务就是指逻辑上的一组SQL语句操作，组成这组操作的各个SQL语句，执行时要么全成功要么全失败。
        例如：你给我转账5块钱，流程如下
            a.从你银行卡取出5块钱，剩余计算money-5
            b.把上面5块钱打入我的账户上，我收到5块，剩余计算money+5.
        上述转账的过程，对应的sql语句为：
                update 你_account set money=money-5 where name='你'；
                update 我_account set money=money+5 where name='我'；
        上述的两条SQL操作，在事务中的操作就是要么都执行，要么都不执行，不然钱就对不上了。
        这就是事务的原子性(Atomicity)。
    事务的四大特性：
        1.原子性(Atomicity)
            事务是一个不可分割的单位，事务中的所有SQL等操作要么都发生，要么都不发生。
        2.一致性(Consistency)
            事务发生前和发生后，数据的完整性必须保持一致。
        3.隔离性(Isolation)
            当并发访问数据库时，一个正在执行的事务在执行完毕前，对于其他的会话是不可见的，多个并发事务之间的数据是相互隔离的。也就是其他人的操作在这个事务的执行过程中是看不到这个事务的执行结果的，也就是他们拿到的是这个事务执行之前的内容，等这个事务执行完才能拿到新的数据。
        4.持久性(Durability)
            一个事务一旦被提交，它对数据库中的数据改变就是永久性的。如果出了错误，事务也不允撤销，只能通过'补偿性事务'。
        
    事务的开启：
        数据库默认事务是自动提交的，也就是发一条sql他就执行一条。如果想多条sql放在一个事务中执行，则需要使用事务进行处理。当我们开启一个事务，并且没有提交，mysql会自动回滚事务。或者我们使用rollback命令手动回滚事务。
        数据库开启事务的命令，我们后面会讲到~~~
```

**其他引擎**

```
#MyISAM引擎　　
MyISAM引擎特点：
        1.不支持事务
            事务是指逻辑上的一组操作，组成这组操作的各个单元，要么全成功要么全失败。
        2.表级锁定
            数据更新时锁定整个表：其锁定机制是表级锁定，也就是对表中的一个数据进行操作都会将这个表锁定，其他人不能操作这个表，这虽然可以让锁定的实现成本很小但是也同时大大降低了其并发性能。
        3.读写互相阻塞
            不仅会在写入的时候阻塞读取，MyISAM还会再读取的时候阻塞写入，但读本身并不会阻塞另外的读。
        4.只会缓存索引
            MyISAM可以通过key_buffer_size的值来提高缓存索引，以大大提高访问性能减少磁盘IO，但是这个缓存区只会缓存索引，而不会缓存数据。
        
        5.读取速度较快
            占用资源相对较少
        6.不支持外键约束，但只是全文索引
        7.MyISAM引擎是MySQL5.5版本之前的默认引擎，是对最初的ISAM引擎优化的产物。
        
#NDB 存储引擎
2003 年,MySQL AB 公司从 Sony Ericsson 公司收购了 NDB 存储引擎。 NDB 存储引擎是一个集群存储引擎,类似于 Oracle 的 RAC 集群,不过与 Oracle RAC 的 share everything 结构不同的是,其结构是 share nothing 的集群架构,因此能提供更高级别的 高可用性。NDB 存储引擎的特点是数据全部放在内存中(从 5.1 版本开始,可以将非索引数 据放在磁盘上),因此主键查找(primary key lookups)的速度极快,并且能够在线添加 NDB 数据存储节点(data node)以便线性地提高数据库性能。由此可见,NDB 存储引擎是高可用、 高性能、高可扩展性的数据库集群系统,其面向的也是 OLTP 的数据库应用类型。

#Memory 存储引擎
正如其名,Memory 存储引擎中的数据都存放在内存中,数据库重 启或发生崩溃,表中的数据都将消失。它非常适合于存储 OLTP 数据库应用中临时数据的临时表,也可以作为 OLAP 数据库应用中数据仓库的维度表。Memory 存储引擎默认使用哈希 索引,而不是通常熟悉的 B+ 树索引。

#Infobright 存储引擎
第三方的存储引擎。其特点是存储是按照列而非行的,因此非常 适合 OLAP 的数据库应用。其官方网站是 http://www.infobright.org/,上面有不少成功的数据 仓库案例可供分析。

#NTSE 存储引擎
网易公司开发的面向其内部使用的存储引擎。目前的版本不支持事务, 但提供压缩、行级缓存等特性,不久的将来会实现面向内存的事务支持。

#BLACKHOLE
黑洞存储引擎，可以应用于主备复制中的分发主库。

MySQL 数据库还有很多其他存储引擎,上述只是列举了最为常用的一些引擎。如果 你喜欢,完全可以编写专属于自己的引擎,这就是开源赋予我们的能力,也是开源的魅 力所在。
```

